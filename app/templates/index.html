<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>erez.ac - Konsta Janhunen</title>
    <link rel="stylesheet" href="/static/assets/style.css">
    <link rel="icon" href="/static/favicon.ico">
    <script type="application/ld+json">
        {
            "@context": "https://schema.org",
            "@type": "Person",
            "name": "Konsta Janhunen",
            "url": "https://erez.ac"
        }
    </script>
</head>
<body>
    <div id="app"></div>

    <script src="/static/script/vue.global.js"></script>
    <script src="/static/script/vue-router.global.prod.js"></script>
    <script>
    var createApp = Vue.createApp;
    var ref = Vue.ref;
    var onMounted = Vue.onMounted;
    var createRouter = VueRouter.createRouter;
    var createWebHistory = VueRouter.createWebHistory;

        var AppHeader = {
            template: [
                '<div class="flex justify-between items-baseline bg-dark px-6 h-[5.5rem] border-b-[3px] border-light">',
                '  <div class="left_items flex gap-10 items-baseline font-normal text-2xl leading-6">',
                '    <div class="text-white"><router-link to="/" class="!text-white text-4xl">erez.ac</router-link></div>',
                '    <div id="h2" class="font-light text-gray-400">Konsta Janhunen</div>',
                '  </div>',
                '  <div class="flex h-full items-center">',
                '    <a v-for="link in navLinks" :key="link.slug" :href="\'#\' + link.slug"',
                '       class="!text-white px-4 flex items-center justify-center h-full box-border transition-colors duration-300 hover:bg-[#222] hover:!text-accent">',
                '      {% raw %}{{ link.label }}{% endraw %}',
                '    </a>',
                '  </div>',
                '</div>'
            ].join('\n'),
            setup: function() {
                var navLinks = ref([]);
                onMounted(function() {
                    fetch('/api/sections')
                        .then(function(res) { return res.json(); })
                        .then(function(sections) {
                            navLinks.value = sections.map(function(s) {
                                return { slug: s.slug, label: s.title };
                            });
                        })
                        .catch(function() {
                            navLinks.value = [
                                { slug: 'who', label: 'Who' },
                                { slug: 'what', label: 'What' },
                                { slug: 'where', label: 'Where' }
                            ];
                        });
                });
                return { navLinks: navLinks };
            }
        };

        var TerminalWindow = {
            template: [
                '<div id="terminal">',
                '  <div id="terminal_bar">',
                '    <div>&nbsp;</div>',
                '    <div id="bar_user">konsta@erez.ac:~</div>',
                '    <div class="bar_buttons">',
                '      <button class="bar_button">\u2013</button>',
                '      <button class="bar_button">\u2610</button>',
                '      <button class="bar_button" id="exit_button">\u2715</button>',
                '    </div>',
                '  </div>',
                '  <div id="terminal_body">',
                '    <div class="line">',
                '      <span class="terminal_prompt">',
                '        <span id="user">konsta@erez.ac</span>',
                '        <span>:</span>',
                '        <span id="dir">~</span>',
                '        <span id="bling">$</span>',
                '      </span>',
                '      <span id="command">{% raw %}{{ typedCommand }}{% endraw %}</span>',
                '    </div>',
                '    <pre id="output">{% raw %}{{ cowsayOutput }}{% endraw %}</pre>',
                '    <div class="line" v-if="showNewPrompt">',
                '      <span class="terminal_prompt">',
                '        <span id="user">konsta@erez.ac</span>',
                '        <span>:</span>',
                '        <span id="dir">~</span>',
                '        <span id="bling">$</span>',
                '        <span id="cursor"></span>',
                '      </span>',
                '    </div>',
                '  </div>',
                '</div>'
            ].join('\n'),
            setup: function() {
                var typedCommand = ref('');
                var cowsayOutput = ref('');
                var showNewPrompt = ref(false);
                var commandText = 'cowsay moo';
                function typeCommand(i) {
                    if (i < commandText.length) {
                        typedCommand.value += commandText[i];
                        setTimeout(function() { typeCommand(i + 1); }, 80);
                    } else {
                        setTimeout(fetchCowsay, 100);
                    }
                }
                function fetchCowsay() {
                    fetch('/api/cowsay')
                        .then(function(res) { return res.json(); })
                        .then(function(data) {
                            cowsayOutput.value = data.output;
                            showNewPrompt.value = true;
                        })
                        .catch(function() {
                            cowsayOutput.value = 'Error fetching cowsay';
                        });
                }
                onMounted(function() {
                    setTimeout(function() { typeCommand(0); }, 3000);
                });
                return { typedCommand: typedCommand, cowsayOutput: cowsayOutput, showNewPrompt: showNewPrompt };
            }
        };

        var SectionBlock = {
            props: { section: { type: Object, required: true } },
            template: [
                '<div class="text-base leading-relaxed mb-6" :id="section.slug">',
                '  <h2 class="text-2xl leading-loose border-b border-black m-0">{% raw %}{{ section.title }}{% endraw %}</h2>',
                '  <p v-html="section.content"></p>',
                '</div>'
            ].join('\n')
        };

        var AppFooter = {
            props: { updateDate: { type: String, default: '' } },
            template: [
                '<div class="flex-grow bg-dark m-0 px-4 py-3 h-10 border-t-[3px] border-light text-gray-500 box-border">',
                '  <span v-if="updateDate">Last updated: {% raw %}{{ updateDate }}{% endraw %}</span>',
                '  <span v-else>&nbsp;</span>',
                '</div>'
            ].join('\n')
        };

        var NotFound = {
            template: [
                '<div class="flex flex-col items-center justify-center py-20 text-center">',
                '  <h1 class="text-6xl font-bold text-dark mb-4">404</h1>',
                '  <p class="text-xl text-gray-500 mb-8">Page not found</p>',
                '  <router-link to="/" class="text-accent hover:underline text-lg">Back to home</router-link>',
                '</div>'
            ].join('\n')
        };

        var HomePage = {
            template: [
                '<div>',
                '  <terminal-window></terminal-window>',
                '  <div v-if="loading" class="space-y-6">',
                '    <div v-for="n in 3" :key="n" class="animate-pulse">',
                '      <div class="h-8 bg-gray-200 rounded w-1/4 mb-3"></div>',
                '      <div class="h-4 bg-gray-100 rounded w-full mb-2"></div>',
                '      <div class="h-4 bg-gray-100 rounded w-3/4"></div>',
                '    </div>',
                '  </div>',
                '  <div v-else-if="error" class="bg-red-50 border border-red-200 rounded-lg p-6 text-center">',
                '    <p class="text-red-600 mb-2">Failed to load content.</p>',
                '    <p class="text-gray-500 text-sm">Please try refreshing the page.</p>',
                '  </div>',
                '  <template v-else>',
                '    <section-block v-for="section in sections" :key="section.id" :section="section"></section-block>',
                '  </template>',
                '</div>'
            ].join('\n'),
            components: {
                'terminal-window': TerminalWindow,
                'section-block': SectionBlock
            },
            props: ['sections', 'loading', 'error']
        };

        var routes = [
            { path: '/', component: HomePage },
            { path: '/:pathMatch(.*)*', component: NotFound }
        ];

        var router = createRouter({
            history: createWebHistory(),
            routes: routes
        });

        var app = createApp({
            template: [
                '<div class="flex flex-col h-full shadow-lg">',
                '  <app-header></app-header>',
                '  <div class="flex-grow p-6 bg-white text-dark border-t-4 border-b-4 border-accent">',
                '    <router-view :sections="sections" :loading="loading" :error="error"></router-view>',
                '  </div>',
                '  <app-footer :update-date="updateDate"></app-footer>',
                '</div>'
            ].join('\n'),
            components: {
                'app-header': AppHeader,
                'app-footer': AppFooter
            },
            setup: function() {
                var sections = ref([]);
                var updateDate = ref('');
                var loading = ref(true);
                var error = ref(null);
                onMounted(function() {
                    Promise.all([
                        fetch('/api/sections').then(function(r) { return r.json(); }),
                        fetch('/api/meta').then(function(r) { return r.json(); })
                    ]).then(function(results) {
                        sections.value = results[0];
                        updateDate.value = results[1].update_date;
                        loading.value = false;
                    }).catch(function(e) {
                        console.error('Failed to load site data:', e);
                        error.value = e;
                        loading.value = false;
                    });
                });
                return { sections: sections, updateDate: updateDate, loading: loading, error: error };
            }
        });

    app.use(router);
    app.mount('#app');
    </script>
</body>
</html>
